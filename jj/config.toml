"$schema" = "https://jj-vcs.github.io/jj/prerelease/config-schema.json"

[user]
name = "Anton Älgmyr"
email = "anton@algmyr.se"

[aliases]
pdiff = ["diff", "--from", "@--"]
pstatus = ["pdiff", "-s"]
pst = ["pstatus"]
l = ["log", "-r", "interesting", "--no-pager"]
tug = ["bookmark", "move", "--from", "closest_bookmark(@)", "--to", "closest_pushable(@)"]
tug_to = ["bookmark", "move", "--from", "closest_bookmark(@)", "--to"]
mainline = ["rebase", "-A", "closest_pushable(@)"]
amend_noprop = ["restore", "--restore-descendants", "--from", "@", "--into", "@-"]

vim = ["util", "exec", "--", "jj_helper", "vim"]
pedit = ["util", "exec", "--", "jj_helper", "pedit"]
conflicted = ["util", "exec", "--", "jj_helper", "conflicted"]
conflicted_plain = ["util", "exec", "--", "jj_helper", "conflicted_plain"]
prefix = ["util", "exec", "--", "jj_helper", "prefix"]
unprefix = ["util", "exec", "--", "jj_helper", "unprefix"]

[revsets]
short-prefixes = "interesting"

[revset-aliases]
"work" = 'heads(::@ ~ description(exact:""))::@ & mutable()'
"closest(start, cond)" = '''
  heads(::@ & cond)
'''

"archived" = 'description("archive: ") ~ immutable()'
"empty_other_wc_on_immutable" = "(working_copies() ~ @) & immutable()+ & empty()"

"interesting" = '''
  ancestors(reachable(
    ((mine() & mutable()) ~ archived ~ empty_other_wc_on_immutable) | @,
    mutable(),
  ), 2)
  | trunk() | @
'''

working_commits = "@|((description(exact:'')&@)-&mutable())"

'closest_bookmark(to)' = 'heads(::to & bookmarks())'
'_before_megamerge(x)' = '''
  coalesce(::fork_point((merges() & ::x)-), ::x)
'''
'closest_pushable(to)' = '''
  heads(
    ::to
    & ~description(exact:"")
    & (~empty() | merges())
    & _before_megamerge(to)
  )
'''

[template-aliases]
'ellipsize(s, n)' = '''
  if(s.substr(n, 999), s.substr(0, n).substr(0, -1) ++ "…", s)
'''
'shell_summary()' = '''
  separate(' ',
    if(self.contained_in("@") && empty, label('empty', '(empty)')),
    if(
      description,
      label('shell_desc', "[" ++ ellipsize(description.first_line(), 20) ++ "]")
    )
  ) ++ "\n"
'''

[templates]
log = 'algmyr_log_compact'
git_push_bookmark = '"algmyr/push-" ++ change_id.short()'

draft_commit_description = '''
concat(
  coalesce(description, default_commit_description, "\n"),
  surround(
    "\nJJ: This commit contains the following changes:\n", "",
    indent("JJ:     ", diff.stat(72)),
  ),
  "\nJJ: ignore-rest\n",
  diff.git(),
)
'''

[ui]
default-command = "l"
log-synthetic-elided-nodes = true
log-word-wrap = true
diff-editor = ":builtin"

[colors]
#"commit_id" = "bright black"
#"working_copy commit_id" = "bright black"
"rest" = "black"
"prefix" = { bold = false }

"email" = "yellow"
"username" = "yellow"
"working_copy email" = "bright yellow"
"working_copy username" = "bright yellow"
"timestamp" = "default"
"working_copy timestamp" = "default"

"op_log current_operation" = { bold = true }
"op_log current_operation user" = "bright yellow"
"op_log time"                   = "white"
"op_log current_operation time" = "bright white"
"op_log current_operation description" = { bold = true }

"shell_desc" = "bright blue"
