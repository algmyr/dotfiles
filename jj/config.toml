[user]
name = "Anton Älgmyr"
email = "anton@algmyr.se"

[aliases]
pdiff = ["diff", "--from", "@--"]
pstatus = ["pdiff", "-s"]
editnext = ["edit", "-r", "@+"]
editprev = ["edit", "-r", "@-"]
splice = ["--config-toml", 'ui.merge-editor="splice"']
l = ["log", "-r", "interesting"]
ll = ["l", "--summary"]
xl = ["log", "-r", "xlbase::"]

[revsets]
short-prefixes = "interesting"

[revset-aliases]
"closest(x)" = "(::@&x) ~ ::(::@&x)-"
"furthest(x)" = "x ~ x+::"

"prev_branch()" = "closest(immutable_heads()|branches()|root())"
"gh-pages" = 'ancestors(remote_branches(exact:"gh-pages"))'
"interesting" = "ancestors(mine() ~ ::trunk(), 2) | trunk()"

[template-aliases]
'format_timestamp(timestamp)' = 'timestamp.ago()'
'format_short_change_id(id)' = 'id.shortest()'


'label_log_node(content)' = '''
label("node",
  coalesce(
    if(!self, label("elided", content)),
    if(immutable, label("immutable", content)),
    if(conflict, label("conflict", content)),
    if(current_working_copy, label("working_copy", content)),
    label("normal", content)
  )
)
'''
'label_op_log_node(content)' = '''
label("node",
  coalesce(
    if(current_operation, label("working_copy", content))
    label("normal", content)
  )
)
'''

[templates]
log_node = '''
label_log_node(
  coalesce(
    if(!self, "⇋"),
    if(current_working_copy, "@"),
    if(immutable, "◆"),
    if(conflict, "×"),
    "○"
  )
)
'''
op_log_node = '''
label_op_log_node(
  coalesce(
    if(current_operation, "@")
    "○"
  )
)
'''

[ui]
default-revset = "(@ | ancestors(immutable_heads().., 2) | trunk()) ~ gh-pages"
default-command = "l"
#graph.style = "ascii"
#graph.style = "square"
log-synthetic-elided-nodes = true
log-word-wrap = true

[merge-tools]
splice.merge-args = ["$base", "$left", "$left", "$right", "$output", "-c", "SpliceInit"]
splice.program = "vim"
splice.merge-tool-edits-conflict-markers = true

[colors]
"node" = { bold = true }
"node elided" = { fg = "bright black" }
"node working_copy" = { fg = "green" }
"node immutable" = { fg = "bright cyan" }
"node conflict" = { fg = "red" }
"node normal" = { bold = false }


# { fg = "green", bg = "red", bold = true, underline = true }
"commit_id" = "green"
"change_id" = "magenta"
"working_copy commit_id" = "bright green"
"working_copy change_id" = "bright magenta"

# Prefix/rest
"prefix" = { bold=true }
"rest" = "bright black"

"email" = "yellow"  # make bright?
"working_copy email" = "bright yellow"
"username" = "yellow"
"working_copy username" = "bright yellow"
"timestamp" = "white"
"working_copy timestamp" = "bright white"

description = "bright white"
"working_copy description" = { bold = true }

"working_copy" = { bold = true }

"op_log current_operation" = { bold = true }
"op_log current_operation user" = "bright yellow"
"op_log time"                   = "white"
"op_log current_operation time" = "bright white"
"op_log current_operation description" = { bold = true }
